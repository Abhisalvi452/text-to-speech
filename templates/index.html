<!DOCTYPE html>
<html>
<head>
    <title>Enhanced Text-to-Speech</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        .parameter-control {
            margin: 10px 0;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .slider-value {
            min-width: 60px;
        }
    </style>
</head>
<body>
    <h1>Text-to-Speech Converter</h1>
    
    <div>
        <textarea id="text" rows="5" cols="50" placeholder="Enter text to convert"></textarea>
    </div>

    <div>
        <label for="voice">Select Voice:</label>
        <select id="voice">
            {% for voice_name, voice_info in voices.items() %}
                <option value="{{ voice_name }}">{{ voice_name }}</option>
            {% endfor %}
        </select>
    </div>

    <div>
        <label for="style">Select Style:</label>
        <select id="style">
            <option value="default">Default</option>
        </select>
    </div>

    <div class="parameter-control">
        <label>Speech Rate:</label>
        <div class="slider-container">
            <input type="range" id="rate" min="-100" max="100" value="0">
            <span class="slider-value" id="rate-value">+0%</span>
        </div>
    </div>

    <div class="parameter-control">
        <label>Volume:</label>
        <div class="slider-container">
            <input type="range" id="volume" min="-100" max="100" value="0">
            <span class="slider-value" id="volume-value">+0%</span>
        </div>
    </div>

    <div class="parameter-control">
        <label>Pitch:</label>
        <div class="slider-container">
            <input type="range" id="pitch" min="-100" max="100" value="0">
            <span class="slider-value" id="pitch-value">+0Hz</span>
        </div>
    </div>

    <button onclick="generateSpeech()">Generate Speech</button>

    <div id="audio-player" style="display: none; margin-top: 20px;">
        <audio controls id="audio-element"></audio>
        <button onclick="downloadAudio()">Download Audio</button>
    </div>

    <script>
        // Update style options when voice changes
        $('#voice').change(function() {
            const selectedVoice = $(this).val();
            $.get(`/voice_features/${selectedVoice}`, function(data) {
                const styleSelect = $('#style');
                styleSelect.empty();
                styleSelect.append($('<option>').val('default').text('Default'));
                data.styles.forEach(style => {
                    if (style !== 'default') {
                        styleSelect.append($('<option>').val(style).text(style));
                    }
                });
            });
        });

        // Update slider values
        function updateSliderValue(slider, value, unit) {
            $(`#${slider}-value`).text((value >= 0 ? '+' : '') + value + unit);
        }

        $('#rate').on('input', function() {
            updateSliderValue('rate', $(this).val(), '%');
        });

        $('#volume').on('input', function() {
            updateSliderValue('volume', $(this).val(), '%');
        });

        $('#pitch').on('input', function() {
            updateSliderValue('pitch', $(this).val(), 'Hz');
        });

        function generateSpeech() {
            const formData = new FormData();
            formData.append('text', $('#text').val());
            formData.append('voice', $('#voice').val());
            formData.append('style', $('#style').val());
            formData.append('rate', $('#rate-value').text());
            formData.append('volume', $('#volume-value').text());
            formData.append('pitch', $('#pitch-value').text());

            $.ajax({
                url: '/generate_audio',
                method: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function(response) {
                    if (response.success) {
                        $('#audio-element').attr('src', response.audio_path);
                        $('#audio-player').show();
                        window.currentAudioFile = response.filename;
                    } else {
                        alert('Error: ' + response.error);
                    }
                },
                error: function() {
                    alert('Error generating audio');
                }
            });
        }

        function downloadAudio() {
            if (window.currentAudioFile) {
                window.location.href = '/download_audio/' + window.currentAudioFile;
            }
        }
    </script>
</body>
</html>
